#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

void readFlag()
{
    int file = open("flag.txt", O_RDONLY);
    if (!file) {
        puts("Unable to open flag.");
        exit(1);
    }
    
    char flag[100];
    read(file, flag, sizeof(flag)); 
    
    printf("The flag is: %s\n", flag);
    exit(0);
}

int main() {
    //Make sure program is running as level01 user
    setresuid(getegid(), getegid(), getegid());
    setresgid(getegid(), getegid(), getegid());
    
    //disable buffering.
    setbuf(stdout, NULL);
    
    int val = 0;
    char buf[44];
    
    printf("Overflow me: ");
    gets(buf); //The vulnerable call
    printf("You entered: %x\n", val);
    
    if (val == 0x1337c0de) {
        printf("Success!");
        readFlag();
    } else {
        printf("You failed!");
    }
    
}